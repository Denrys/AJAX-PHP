<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>注册页面</title>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
      .register{
        margin: 0 auto;
        width: 280px;
        margin-top:80px 
      }
    </style>

  </head>
  <body>



<div class="register">
<!-- 账号输入不正确警告 -->
<div class="alert alert-warning alert-dismissible"  id="alert4" role="alert"  style="display: none;position: absolute">
  <strong>警告!</strong> 请输入3-20位用户名
</div>
<!-- 密码输入不正确警告 -->
<div class="alert alert-warning alert-dismissible"  id="alert5" role="alert"  style="display: none;position: absolute">
  <strong>警告!</strong> 请输入5-20位密码
</div>

<!-- 确认密码输入不正确警告 -->
<div class="alert alert-warning alert-dismissible"  id="alert6" role="alert"  style="display: none;position: absolute">
  <strong>警告!</strong> 请输入5-20确认密码
</div>

<!-- 俩密码不相同警告 -->
<div class="alert alert-warning alert-dismissible"  id="alert7" role="alert"  style="display: none;position: absolute">
  <strong>警告!</strong> 密码和确认密码不同
</div>

<div class="alert alert-warning alert-dismissible"  id="alert8" role="alert"  style="display: none;position: absolute">
  <strong>警告!</strong> 验证码不正确
</div>

<div class="alert alert-success" role="alert"  id="alert9" style="display: none;position: absolute">注册成功</div>

<div class="alert alert-warning alert-dismissible"  id="alert10" role="alert"  style="display: none;position: absolute">
  <strong>警告!</strong> 用户名已存在
</div>


 <p>注册界面</p>
<!--     <form role="form"> -->
      <div class="form-group">
        <label>用户名</label>
        <input type="text" class="form-control"  placeholder="请输入您的用户名..."  id="rname"  name="name1"  value="admin"></div>
      <div class="form-group">
        <label>密码</label>
        <input type="password" class="form-control" placeholder="请输入您的密码..." id="rpasswd1"  value="12345"></div> 
      <div class="form-group">
        <label>确认密码</label>
        <input type="password" class="form-control" placeholder="请输入您的确认密码..." id="rpasswd2" value="12345"></div>
     <div class="form-group">
        <label>验证码</label>
        <input type="text" class="form-control"  placeholder="请输入验证码..."  id="code"  name="code">
        <img src="php/code.php"   onclick="this.src='php/code.php?'+Math.random();"alt="">
      </div>

      <button  class="btn btn-default"  id="put">提交</button>
    <!-- </form> -->
</div>
<script src="js/jquery.js"></script>
<script>
$(function(){

        //点击提交按钮引发函数
        $('#put').click(function(){

         //获得用户名
        var  rname1 = $('#rname').val();

        //获取用户名长度
        var lenn = $('#rname').val().length;

        //判断用户名是否合格
            if(lenn== ""  ||  lenn <=2 || lenn >20 ){
              //输出提示
              $('#alert4').css("marginTop","-60px").show().delay(3000).hide(0);

              //停止函数，自此不在往下执行
              return false;
            }


      //密码验证
      //获取密码长度
       var  lenp = $('#rpasswd1').val().length;
       //获取密码的值
       var  rpasswd1 = $('#rpasswd1').val();
       //密码验证
          if(lenp== ""  ||  lenp < 5 || lenp >20 ){
            //输出提示
            $('#alert5').css("marginTop","-60px").show().delay(3000).hide(0);
              //停止函数，自此不在往下执行
            return false;
          }


      //确认密码验证
       var  lenp = $('#rpasswd2').val().length;
       //获得确认密码的值
        var  rpasswd2 = $('#rpasswd2').val();
          if(lenp== ""  ||  lenp < 5 || lenp >20 ){
            //输出提示
            $('#alert6').css("marginTop","-60px").show().delay(3000).hide(0);
            return false;
          }

      //验证俩密码是否相同
      if(rpasswd1 != rpasswd2){
        //不同输出提示
         $('#alert7').css("marginTop","-60px").show().delay(3000).hide(0);
         //并清空俩输入框的值
         $('#rpasswd1').val("");
         $('#rpasswd2').val("");
        return false;
      }

  // 从php取出验证码
    // $.get("php/register.php?action=getCode",function(res){
    //    code2 = res;
    // });


    $.get({
        url:"php/admin.php?action=getCode",
        datatype:"json",
        async: false,
        success:function(data){
            code2=$.parseJSON(data);
        }
    });

    $("#code").val(code2);
    //验证输入验证码是否对


    var code = $("#code").val();
    if(code ==""  || code !=code2){
      $('#alert8').css("marginTop","-60px").show().delay(3000).hide(0);
       return false;
    }



//注册插入
$.post({
    url :"php/admin.php?action=register",
    data:{
       name :rname1,
       passwd : rpasswd1,
       code : code
     },
    datatype:"json",
    //async: false,
    success:function(res){


if(res.trim() == "ok"){

        // 登录成功提示
    $('#alert9').css("marginTop","-60px").show().delay(3000).hide(0);
       //登录注册所在自动隐藏
    $('#form0').hide();

    //空form显示，为后面加节点做准备
    $('#form1').show();

    var word =$('<p  style="color: white;float:left;line-height:24px;"  id="p1">欢迎你，</p>');
    word.appendTo('#form1');
    var w = $('<p  style="color: white;float:left;line-height:24px;" id="p2"></p>');

    w.appendTo('#form1');

     $('#p2').html(rname1);

    //显现左侧菜单
     $('.list').show();
     setTimeout(function(){$(".right").load("login.html");},2000);
      }else{
       $('#alert10').css("marginTop","-60px").show().delay(3000).hide(0);
      }

    }
})
    })//注册页面
})
</script>
<script src="js/bootstrap.min.js"></script>
</body>
</html>